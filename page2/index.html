<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      try/finally
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="index">

    <div id="sidebar">
  <header>
    <h1 class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        try/finally
      </a>
    </h1>
    <p class="lead">Occasional programming thoughts of Mark Watts.</p>
  </header>
  <nav id="sidebar-nav-links">
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about/">About</a>
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  


  


  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  
    <span class="site-version">Currently v1.0</span>
  

  <nav id="sidebar-icon-links">
  

  
  
  
  

  <a id="github-link"
      class="icon"
      title="GitHub" aria-label="GitHub"
      href="https://github.com/wattsm"
      target="_blank">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28" height="24" width="28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

  </a>

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p>
  &copy; 2020.  
</p>

</div>

    <main class="container">
      <div class="content">
  
<div class="pagination">
  <a class="pagination-item newer"
     href="/">
    Newer
  </a>
</div>



  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/programming/fsharp/2015/10/15/lenses-in-fsharp/">
        Lenses in F#
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">15 Oct 2015</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        programming
      
    
      &bull;

      
      
      

      
        fsharp
      
    
  </span>
</div>


    
      <p>I recently came across the concept of lenses in functional programming - a useful tool that can significantly reduce the amount of boilerplate code required when working
with <a href="https://msdn.microsoft.com/en-us/library/dd233184.aspx">record types</a>. I first noticed them in <a href="http://suave.io/">suave</a>’s source code and, intrigued, did some further research which lead me to <a href="https://www21.in.tum.de/teaching/fp/SS15/papers/17.pdf">this paper</a> by Albert Steckermeier 
which describes the concept in detail (using Haskell).</p>

<p>As my background is primarily with OO languages I find that I quite often stumble across concepts in functional programming that more experienced practitioners would 
take for granted. There did not seem to a huge amount of information on lenses out there, so I thought I would write a short post about lenses in F#.</p>


    

    
      
      
      

      
        <a href="/programming/fsharp/2015/10/15/lenses-in-fsharp/">More &hellip;</a>
      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/programming/fsharp/2015/05/20/modeling-historical-dates/">
        Modeling historical dates
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">20 May 2015</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        programming
      
    
      &bull;

      
      
      

      
        fsharp
      
    
  </span>
</div>


    
      <p>As a part of a side project I continually fail to actually start I would need the ability to sort events based on a date. Sounds simple, right? And so it would be if 
all of the dates were CE (or AD if you prefer) or if .Net’s DateTime type supported BCE dates. Unfortunately these dates could be BCE or CE and System.DateTime’s 
minimum value is 1st Jan 1 CE. Further complicating the matter is the fact that these dates come from historical sources which can be extremely vague (e.g. “before January 17 BCE”).</p>

<p>In this post I will look at modeling historical dates using F#. I’ll look at creating a model that captures the vagueness of historical dates and a method for sorting them which is 
further complicated by the surprisingly chequered history of leap years.</p>


    

    
      
      
      

      
        <a href="/programming/fsharp/2015/05/20/modeling-historical-dates/">More &hellip;</a>
      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/programming/csharp/2015/04/10/odata-graph-delta/">
        WebAPI OData GraphDelta<T>
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">10 Apr 2015</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        programming
      
    
      &bull;

      
      
      

      
        csharp
      
    
  </span>
</div>


    
      <p>In the course of a recent project I ran into a problem with the standard <code class="highlighter-rouge">Delta&lt;T&gt;</code> included in Microsoft WebAPI’s OData functionality: it treats complex properties as atomic 
values meaning that instead of applying the delta to the existing value of the complex property it will create a new, blank value, apply the delta to that
and then set the complex property to the result.</p>

<p><a href="http://stackoverflow.com/questions/27963113/using-deltat-with-complex-objects">I asked about this behaviour on StackOverflow</a> and it turns out that it’s a <a href="https://github.com/OData/WebApi/issues/135">known issue</a>. This post briefly outlines how I implemented an alternative to <code class="highlighter-rouge">Delta&lt;T&gt;</code> that handled changes to 
complex types the same way as changes are handled for entities. The post will feature minimal code but source code is <a href="https://github.com/wattsm/odata-graph-delta">available on GitHub</a>.</p>


    

    
      
      
      

      
        <a href="/programming/csharp/2015/04/10/odata-graph-delta/">More &hellip;</a>
      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/programming/fsharp/2015/02/13/using-dbscan-for-fun-and-profit-in-elite-dangerous/">
        Using DBSCAN for fun and (mostly) profit in Elite:Dangerous
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">13 Feb 2015</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        programming
      
    
      &bull;

      
      
      

      
        fsharp
      
    
  </span>
</div>


    
      <p><a href="https://www.elitedangerous.com/">Elite:Dangerous</a> is the reboot of the classic 1984 space trading, combat and exploration game <a href="http://en.wikipedia.org/wiki/Elite_%28video_game%29">Elite</a> and it has been out for a few months now. After some initial aimless wandering I, like a lot of
people, settled on a career trading rare goods. These goods, as their name suggests, are rare and available in limited quantities and can bring in huge profits if sold sufficiently far away from 
their system of origin.</p>

<p>In order to maximise profits it is desirable to circulate as much as possible between systems that supply rare goods, buying and selling at each stop. One popular strategy
is to follow a circular route, periodically selling and buying. Another, and the one I favour, is to ferry cargo between clusters of systems that supply rare goods - zipping around one cluster buying 
goods and then travelling to another to sell before repeating the process.</p>

<p>The Elite:Dangerous community has done a good job of exploring the game’s trade network and documenting what rare goods are available where, but it can be hard to visualise the systems relative to each
other, even using the in-game galaxy map. So I thought it would be interesting to see if I could take that community generated data and group the systems together into clusters programmatically.</p>

<p>This post details how I used an immutable <a href="http://en.wikipedia.org/wiki/DBSCAN">DBSCAN</a> implementation to identify rare goods clusters in Elite:Dangerous.</p>


    

    
      
      
      

      
        <a href="/programming/fsharp/2015/02/13/using-dbscan-for-fun-and-profit-in-elite-dangerous/">More &hellip;</a>
      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/programming/fsharp/2015/01/19/futures-in-fsharp/">
        Futures in F#
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">19 Jan 2015</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        programming
      
    
      &bull;

      
      
      

      
        fsharp
      
    
  </span>
</div>


    
      <p>My first exposure to the concept of <a href="http://en.wikipedia.org/wiki/Futures_and_promises">futures (or promises)</a> was probably JavaScript’s <a href="https://github.com/kriskowal/q/wiki/API-Reference">Q API</a> and AngularJS’ <a href="https://docs.angularjs.org/api/ng/service/$q">$q service</a>, but it was only after reading Twitter’s 
“<a href="https://engineering.twitter.com/research/publication/your-server-as-a-function">Your Server as a Function</a>” paper that their usefulness really sank in. The closest thing that .Net has to the Scala futures illustrated in the paper are <code class="highlighter-rouge">Task&lt;T&gt;</code> and 
F#’s <code class="highlighter-rouge">Async&lt;'T&gt;</code>. Although these types are useful they do not provide all of the functionality of Scala’s <code class="highlighter-rouge">Future[T]</code>, nor are they as elegant.</p>

<p>In this post I will describe an approach to creating something akin to Scala’s <code class="highlighter-rouge">Future[T]</code> in F#.</p>


    

    
      
      
      

      
        <a href="/programming/fsharp/2015/01/19/futures-in-fsharp/">More &hellip;</a>
      
    
  </article>
  

  
<div class="pagination">
  <a class="pagination-item older"
     href="/page3">
    Older
  </a>
</div>


</div>
    </main>

    <!-- Optional footer content -->

  </body>
</html>
