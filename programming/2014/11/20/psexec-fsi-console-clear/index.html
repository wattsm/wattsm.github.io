<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>    
	Usermaatre &middot; FSI, PsExec and Console.Clear    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  
  <style type="text/css">
	
	.left-align {
		text-align:left;
	}
	
	.header-bug {
		font-size:0px;
	}
	
  </style>
  
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  
  
</head>


  <body class="theme-base-0b">
  
    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Usermaatre
        </a>
      </h1>
      <p class="lead">Programming, science, history and gaming. Not necessarily in that order.</p>
    </div>

    <nav class="sidebar-nav">
	  <a class="sidebar-nav-item" href="/">Home</a>
	  <a class="sidebar-nav-item" href="/about">About</a>
	  <a class="sidebar-nav-item" href="/archive">Archive</a>
      <a class="sidebar-nav-item" href="https://twitter.com/m_d_watts" target="_blank">Twitter</a>	  
      <a class="sidebar-nav-item" href="https://github.com/wattsm" target="_blank">GitHub</a>      
    </nav>
	
	<p>&copy; 2015. All rights reserved.</p>
	
	
  </div>
</div>


    <div class="content container">	
      <div class="post">
  <h1 class="post-title">FSI, PsExec and Console.Clear</h1>
  <span class="post-date">
	20 Nov 2014
&middot;
Programming 

	&middot;
	<a href="/tags/fsharp">F#</a>, 	

	
	<a href="/tags/psexec">PsExec</a>	

&middot;
<a data-disqus-identifier="FSI, PsExec and Console.Clear" href="/programming/2014/11/20/psexec-fsi-console-clear/#disqus_thread">0 Comments</a>	
  </span>
  <p>I recently struggled with an error that I encountered during the process of setting up a continuous deployment TFS build
and I thought that I would write briefly about it in the hope of helping anyone else running into the same issue. The issue arises running <a href="http://msdn.microsoft.com/en-us/library/dd233175.aspx">FSI</a>
remotely using <a href="http://technet.microsoft.com/en-gb/sysinternals/bb897553.aspx">PsExec</a>.</p>

<!-- more -->

<p>As a part of our continuous deployment build process I had created an F# script responsible for running the installer and performing environment specific
configuration. My plan was to have the TFS build process remotely run this script on the deployment machine using PsExec. The script had been tested manually
and worked as expected, so running it via PsExec should have been fairly straight forward.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">PsExec.exe \\machine -h -accepteula &quot;C:\Program Files (x86)\Microsoft SDKs\F#\3.0\Framework\v4.0\fsi.exe&quot; &quot;C:\Path\To\My\Script.fsx&quot;
</code></pre></div>
<p>However, I immediately ran into problems. Whenever I tried to run the script using PsExec I was greeted with the error <code>System.IO.IOException: The handle is invalid</code>.
Google suggested a number of possible issues from administrative access to writing to the console. After what felt like an eternity of tweaking command line options,
changes to the deployment script and installer I stumbled upon the cause by reducing the script to &quot;Hello, World&quot; and re-introducing functionality piece by piece.</p>

<p>So what was the cause of this error? Running an MSI? Tweaking the registry? Starting and stopping websites in IIS? No, the culprit was this line.</p>
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="nn">Console</span><span class="p">.</span><span class="n">Clear</span> <span class="bp">()</span>
</code></pre></div>
<p>At the beginning of the script I clear the console to make the output more readable. It turns out that clearing the console in a PsExec context is not 
allowed (although <code>Console.WriteLine</code> etc. all still work as expected), presumably because it is a remote console &quot;nested&quot; inside PsExec on a local console.</p>

<p>You can see this effect for yourself by attempting to run this fairly inoffensive script using PsExec.</p>
<div class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span class="k">open</span> <span class="nn">System</span>

<span class="nn">Console</span><span class="p">.</span><span class="n">Clear</span> <span class="bp">()</span>
<span class="nn">Console</span><span class="p">.</span><span class="n">WriteLine</span> <span class="o">(</span><span class="s">&quot;Hello, World&quot;</span><span class="o">)</span>
</code></pre></div>
<p>If you found your way here after running into the same issue I hope this helped!</p>

</div>

<div class="comments">
	<h3>Comments</h3>

	<div id="disqus_thread"></div>
	<script type="text/javascript">
		/* * * CONFIGURATION VARIABLES * * */
		var disqus_shortname = 'usermaatre';
		var disqus_title = "FSI, PsExec and Console.Clear";
		var disqus_identifier = "FSI, PsExec and Console.Clear";
		
		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
			var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
			dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
			(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
    
      <li>
        <h5>
          <a href="/programming/2014/02/03/tfs-2010-xunit/">
            Running xUnit tests as a part of a TFS 2010 build
            <small>03 Feb 2014</small>
          </a>
        </h5>
      </li>
    
      <li>
        <h5>
          <a href="/programming/2015/02/13/using-dbscan-for-fun-and-profit-in-elite-dangerous/">
            Using DBSCAN for fun and (mostly) profit in Elite:Dangerous
            <small>13 Feb 2015</small>
          </a>
        </h5>
      </li>
    
      <li>
        <h5>
          <a href="/programming/2015/05/20/modeling-historical-dates/">
            Modeling historical dates
            <small>20 May 2015</small>
          </a>
        </h5>
      </li>
    
  </ul>
</div>
    </div>

	
	<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'usermaatre';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
  </body>
</html>
